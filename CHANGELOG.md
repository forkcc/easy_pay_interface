# Changelog

## [1.2.0] - 2026-02-20

### Changed
- **Database**: MySQL → PostgreSQL
  - All Flyway migration scripts rewritten for PostgreSQL syntax
  - `TINYINT` → `SMALLINT`, `DATETIME` → `TIMESTAMP`, `AUTO_INCREMENT` → `GENERATED BY DEFAULT AS IDENTITY`
  - Table comments via `COMMENT ON TABLE/COLUMN` statements
  - Automatic `updated_at` via trigger function `update_updated_at()` (replaces MySQL `ON UPDATE CURRENT_TIMESTAMP`)
  - `t_pay_order` uses PostgreSQL declarative partitioning (`PARTITION BY RANGE`)
- **Statistics**: pre-aggregation table `t_order_stat_daily` replaced with 4 PostgreSQL materialized views:
  - `mv_order_stat_daily` — daily stats by date + merchant + agent + payment way
  - `mv_order_stat_mch` — merchant-level summary
  - `mv_order_stat_way` — payment way summary
  - `mv_order_stat_platform_daily` — platform-wide daily overview
- `StatServiceImpl` now uses `REFRESH MATERIALIZED VIEW CONCURRENTLY` + native queries (no JPA entity/repository for stats)
- `DailyStatJob` refreshes all 4 materialized views instead of manual aggregation
- Flyway migrations: V1~V11 (was V1~V10), added V1 for common trigger function, V9 for materialized views
- POM: `mysql-connector-j` → `postgresql`, `flyway-mysql` → `flyway-database-postgresql`
- `application.yml`: JDBC URL, driver, Hibernate dialect switched to PostgreSQL

### Removed
- `OrderStatDaily` entity and `OrderStatDailyRepository` (replaced by materialized views)
- `AccountConverter` OrderStatDaily-related methods
- MySQL-specific DDL syntax from all migration scripts

## [1.1.0] - 2026-02-21

### Added
- **easy-pay-task** module: independent scheduled task runner (Dubbo consumer)
  - `OrderExpireJob` — close expired unpaid orders (every 5 min)
  - `NotifyRetryJob` — retry merchant HTTP callbacks (every 1 min)
  - `DailyStatJob` — aggregate daily order statistics (00:05 daily)
  - `AutoSettleJob` — process pending settlement records (02:30 daily)
- Task configuration via `TaskProperties` with per-job cron & batch size
- Thread pool scheduler (4 threads) with graceful shutdown
- `TASK_ENABLED` environment variable for global task switch

### Changed
- Flyway migrations split from 2 files to 10 domain-specific files (V1~V10)
- All Flyway SQL columns now include COMMENT annotations
- README updated with task module docs, Flyway migration table, project tree

## [1.0.0] - 2026-02-20

### Added
- Initial project structure with easy-pay-api and easy-pay-provider modules
- 6 business domains: Merchant, Payment, Agent, Account/Settlement, Statistics, System Management
- 15 Dubbo service interfaces with full CRUD implementations
- 25 database tables with MySQL partitioning for pay orders
- Daily aggregation statistics table (t_order_stat_daily)
- Flyway database migration (V1~V10, split by domain)
- Dubbo Token authentication for service access control
- Spring Data JPA with HikariCP connection pool optimization
- Apache License 2.0
